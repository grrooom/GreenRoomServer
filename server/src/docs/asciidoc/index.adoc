:doctype: book
:toc: left
:icons: font
:toclevels: 3
:source-highlighter: highlightjs
:sectlinks:

= GreenRoom API Document
2025-01-15

== 개요

=== 문서
[cols="2,4,4", options="header"]
|===
| Name |Url| 비고
| Rest Docs |/docs/index.html| 기본 API 문서
| API Test |/docs/swagger-ui.html| Swagger Api Test 문서
| Error Code Document |/docs/error| Custom Error Code 명세
|===

=== API 서버 경로
[cols="2,4,4", options="header"]
|===
| 환경 | DNS | 비고
| 개발(dev) | https://greenroom-server.site | API 문서 제공
|===

=== 응답형식
다음과 같이 응답형식을 제공합니다.

==== 응답데이터가 없는 경우 예시
[source, json]
----
HTTP/1.1 409 Conflict
Content-Type: application/json
{
  "status": "CONFLICT", // 예시
  "code": "C002", //예시
  "data": null
}
----

==== 응답데이터가 있는 경우 예시
[source, json]
----
HTTP/1.1 200 Conflict
Content-Type: application/json
{
  "status": "OK", //예시
  "code": "A000", //예시
  "data": {
    "id": 123,
    "name": "example"
  }
}
----

==== 공통  ERROR
이 문서에 명시된 실패 응답 외에 서버 측에서 처리하지 못한 예외가 발생하면 다음과 같은 error가 공통적으로 반환됩니다.

[cols="2,4,4", options="header"]
|===
| Http Status | Http Status Code | error code
| INTERNAL_SERVER_ERROR | 500 | D000
|===


== 인증/인가

=== 회원가입
사용자가 이메일과 비밀번호를 기반으로 새로운 계정을 생성할 수 있습니다. +
회원 가입 시 사용되는 사용자의 email 계정은 이메일 인증을 통한 유효성 검사를 거친 후 사용이 가능합니다. +
중복 email로 가입하는 것은 제한됩니다.

==== Request
include::{snippets}/api/auth/signup/1/http-request.adoc[]

==== Request Fields
include::{snippets}/api/auth/signup/1/request-fields.adoc[]


==== 성공 Response
include::{snippets}/api/auth/signup/1/http-response.adoc[]

==== Response Fields
include::{snippets}/api/auth/signup/1/response-fields.adoc[]


==== 실패 Response
실패1.
include::{snippets}/api/auth/signup/2/http-response.adoc[]
실패 2
include::{snippets}/api/auth/signup/3/http-response.adoc[]
실패 3
include::{snippets}/api/auth/signup/4/http-response.adoc[]

---

=== 로그인

등록된 이메일과 비밀번호를 기반으로 사용자를 인증합니다. +
인증 성공 시 Access Token과 Refresh Token을 발급합니다.

==== Request
include::{snippets}/api/auth/login/1/http-request.adoc[]

==== Request Fields
include::{snippets}/api/auth/login/1/request-fields.adoc[]


==== 성공 Response
include::{snippets}/api/auth/login/1/http-response.adoc[]

==== Response Fields
include::{snippets}/api/auth/login/1/response-fields.adoc[]

==== 실패 Response
실패1.
include::{snippets}/api/auth/login/2/http-response.adoc[]
실패2.
include::{snippets}/api/auth/login/3/http-response.adoc[]
실패3.
include::{snippets}/api/auth/login/4/http-response.adoc[]

---

=== 토큰 재발급

사용자가 보유한 Refresh Token을 기반으로 새로운 Access Token과 Refresh Token을 발급합니다. +
유효한 Refresh Token이 제공되면 새롭게 갱신된 토큰 세트를 반환합니다. +
잘못된 토큰 혹은 만료되었거나 무효화된 Refresh 토큰이 제공되면 에러를 반환합니다.

==== Request
include::{snippets}/api/auth/tokens/1/http-request.adoc[]

==== Request Fields
include::{snippets}/api/auth/tokens/1/request-fields.adoc[]


==== 성공 Response
include::{snippets}/api/auth/tokens/1/http-response.adoc[]

==== Response Fields
include::{snippets}/api/auth/tokens/1/response-fields.adoc[]


==== 실패 Response
실패1.
include::{snippets}/api/auth/tokens/2/http-response.adoc[]
실패2.
include::{snippets}/api/auth/tokens/3/http-response.adoc[]
실패3.
include::{snippets}/api/auth/tokens/4/http-response.adoc[]
실패4.
include::{snippets}/api/auth/tokens/5/http-response.adoc[]
---

=== 이메일 인증
회원가입 이전에 사용자의 이메일 주소를 검증하기 위해 사용됩니다. +
API를 요청하면 이메일을 인증하기 위한 jwt 토큰을 앱링크와 함께 전송합니다. +
5회를 초과하여 인증을 시도할 경우 15분간 추가적인 시도가 제한됩니다. +
이미 가입된 user의 email 또는 이미 인증이 완료된 email에 대해서는 추가적인 인증을 제한합니다.

==== Request
include::{snippets}/api/auth/email/authentication/1/http-request.adoc[]

==== Request Fields
include::{snippets}/api/auth/email/authentication/1/request-fields.adoc[]


==== 성공 Response
include::{snippets}/api/auth/email/authentication/1/http-response.adoc[]

==== Response Fields
include::{snippets}/api/auth/email/authentication/1/response-fields.adoc[]


==== 실패 Response
실패1.
include::{snippets}/api/auth/email/authentication/2/http-response.adoc[]
실패2.
include::{snippets}/api/auth/email/authentication/3/http-response.adoc[]
실패3.
include::{snippets}/api/auth/email/authentication/4/http-response.adoc[]
실패4.
include::{snippets}/api/auth/email/authentication/5/http-response.adoc[]
실패5.
include::{snippets}/api/auth/email/authentication/6/http-response.adoc[]
실패6.
include::{snippets}/api/auth/email/authentication/7/http-response.adoc[]

---

=== 이메일 토큰 검증

이메일 인증 요청 시 전송된 JWT 토큰을 검증하여, 해당 토큰이 유효한 경우 이메일 인증을 완료하고, 잘못되거나 만료된 토큰을 전송한 경우 인증을 거부합니다. +
JWT 토큰은 15분의 유효 시간을 가지며 가장 마지막 인증 시도 시 전달된 JWT 토큰만 유효성을 가집니다.

==== Request
include::{snippets}/api/auth/email/token/authentication/1/http-request.adoc[]

==== Request Fields
include::{snippets}/api/auth/email/token/authentication/1/request-fields.adoc[]


==== 성공 Response
include::{snippets}/api/auth/email/token/authentication/1/http-response.adoc[]

==== Response Fields
include::{snippets}/api/auth/email/token/authentication/1/response-fields.adoc[]


==== 실패 Response
실패1.
include::{snippets}/api/auth/email/token/authentication/2/http-response.adoc[]
실패2.
include::{snippets}/api/auth/email/token/authentication/3/http-response.adoc[]
실패3.
include::{snippets}/api/auth/email/token/authentication/4/http-response.adoc[]


